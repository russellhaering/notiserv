<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!--

Design by Russell Haering

Title      : NotiServ
Version    : .01

-->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<title>Notification Monitor</title>
    <script src="jquery-1.3.2.min.js" type="text/javascript"></script>
    <script src="jquery.corners.min.js" type="text/javascript"></script>
    <script type="text/javascript">
    function verifyCredentials(name, passwd, callBack){
        $.ajax({
            type: "GET",
            url: "checkpasswd",
            username: name,
            password: passwd,
            success: callBack
        });
    }
    function onCredentialsVerified(msg){
        alert(msg);
        // TODO: validate msg and repeat until valid credentials are received
        $('#LoginBox').hide();
        $('#PostNotification').show();
        $('#NotificationContainer').show();
        listenForNotifications('russell', 'testing', onNotificationReceived);
    }
    function postNotification(name, passwd, notification, callBack){
        $.ajax({
            type: "POST",
            url: "post",
            username: name,
            password: passwd,
            dataType: 'json',
            data: ({'notificationText': notification}),
            success: callBack
        });
    }
    function onNotificationSent(msg){
        alert(msg);
    }
    function listenForNotifications(name, passwd, callBack){
        $.ajax({
            type: "GET",
            url: "listen",
            username: name,
            password: passwd,
            success: callBack
        });
    }
    function onNotificationReceived(msg){
        // TODO: Verify that this isn't a bad credentials message
        var msgObj = eval(msg)
        $('#NotificationContainer').prepend('<div class="Notification"><a>' + msgObj.message + '</a></div>');
        listenForNotifications('russell', 'testing', onNotificationReceived);
    }
    $(document).ready(function(){
        $('#PostNotification').hide()
        $('#NotificationContainer').hide()
        $('button#LogIn').click(function(){
            verifyCredentials($('input#user').val(), $('input#pass').val(), onCredentialsVerified);
        });
        $('#NotifyButton').click(function(){
            postNotification($('input#user').val(), $('input#pass').val(), $('input#notificationText').val(), onNotificationSent);
        });
    });
    </script>

</head>
<body>
<div id="LoginBox">
    <p><label for="user">Name:</label><input id="user" type="text" /></p>
    <p><label for="pass">Pass:</label><input id="pass" type="password" /></p>
    <p><button id="LogIn">Go!</button></p>
</div>
<div id="PostNotification">
    <p><label for="notificationText">Text:</label><input id="notificationText" type="text" /></p>
    <p><button id="NotifyButton">Notify</button></p>
</div>
<div id="NotificationContainer">
    <div class="Notification">
        <a>This is a Notification!</a>
    </div>
</div>
</body>
</html>
